<!-- COLE ISTO NO LUGAR DO SCRIPT ANTIGO (substitua firebaseConfig pelos seus valores) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  // <-- substitua este objeto com os valores do seu Firebase Console -->
  const firebaseConfig = {
  apiKey: "AIzaSyBhjao8J2BFKz1LVrWcNTsk-ztcSr01tmE",
  authDomain: "padel-scoreboard.firebaseapp.com",
  databaseURL: "https://padel-scoreboard-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "padel-scoreboard",
  storageBucket: "padel-scoreboard.firebasestorage.app",
  messagingSenderId: "1042506310795",
  appId: "1:1042506310795:web:df5861c7cc24816393208e"
};

  // inicializa Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const scoresRef = ref(db, 'scoreboard'); // n√≥ principal onde guardaremos os dados

  // vari√°veis do placar
  let score1 = 0;
  let score2 = 0;
  let ties = 0;
  let history = [];

  // quando o DB mudar, atualizar a UI (n√£o gravar de volta neste evento)
  let suppressSave = false;
  onValue(scoresRef, snapshot => {
    const data = snapshot.val();
    if (data) {
      suppressSave = true; // evita gravar de volta o mesmo dado
      score1 = data.score1 || 0;
      score2 = data.score2 || 0;
      ties = data.ties || 0;
      history = data.history || [];
      // se history chegou como objeto (por algo), convert para array ordenado
      if (!Array.isArray(history)) {
        history = Object.values(history).reverse();
      }
      update(false); // false = n√£o salvar de volta (porque veio do servidor)
      suppressSave = false;
    } else {
      // se DB estiver vazio, inicializa dados remotos
      saveToFirebase();
    }
  });

  function saveToFirebase() {
    if (suppressSave) return;
    // escreve o objeto inteiro no n√≥ 'scoreboard'
    set(scoresRef, { score1, score2, ties, history })
      .catch(err => console.error("Erro ao salvar no Firebase:", err));
  }

  // fun√ß√µes que modificam estado local e chamam update(true) para salvar
  function addWin(team) {
    const time = new Date().toLocaleString();
    if (team === 1) {
      score1++;
      history.unshift(`${time}: Z√© + Sandrina won`);
    } else {
      score2++;
      history.unshift(`${time}: Vitor + Leandro won`);
    }
    update(true);
  }

  function removeWin(team) {
    if (team === 1 && score1 > 0) {
      score1--;
      // remover √∫ltimo registro da hist√≥ria ‚Äî simples: shift/pop depende de como voc√™ quer
      history.shift();
    } else if (team === 2 && score2 > 0) {
      score2--;
      history.shift();
    }
    update(true);
  }

  function addTie() {
    const time = new Date().toLocaleString();
    ties++;
    history.unshift(`${time}: Match tied`);
    update(true);
  }

  function resetSeason() {
    if (!confirm("Reset the season scores?")) return;
    score1 = 0; score2 = 0; ties = 0; history = [];
    update(true);
  }

  // update DOM; se save === true -> salva no Firebase
  function update(save = true) {
    document.getElementById("score1").innerHTML = score1 + " <span id='badge1'></span>";
    document.getElementById("score2").innerHTML = score2 + " <span id='badge2'></span>";

    const totalMatches = score1 + score2 + ties;
    document.getElementById("totalMatches").textContent = totalMatches;
    const rate1 = totalMatches > 0 ? Math.round((score1/totalMatches)*100) + "%" : "0%";
    const rate2 = totalMatches > 0 ? Math.round((score2/totalMatches)*100) + "%" : "0%";
    document.getElementById("rate1").textContent = rate1;
    document.getElementById("rate2").textContent = rate2;
    document.getElementById("ties").textContent = ties;

    // history list
    const list = document.getElementById("historyList");
    if (list) {
      list.innerHTML = "";
      history.forEach(item => {
        const li = document.createElement("li");
        li.textContent = item;
        list.appendChild(li);
      });
    }

    updateBadges();

    if (save) saveToFirebase();
  }

  function updateBadges() {
    const b1 = document.getElementById("badge1");
    const b2 = document.getElementById("badge2");
    if (!b1 || !b2) return;
    b1.textContent = ""; b2.textContent = "";
    if (score1 > score2) { b1.textContent = "ü•á"; b2.textContent = "üí©"; }
    else if (score2 > score1) { b2.textContent = "ü•á"; b1.textContent = "üí©"; }
  }

  // PIN protection (mant√©m a sua fun√ß√£o atual)
  function secureAction(action) {
    const pin = prompt("Enter PIN to edit:");
    if (pin === "0000") {
      action();
    } else {
      alert("Wrong PIN!");
    }
  }

  // expose functions para os bot√µes (caso estejam fora do escopo)
  window.addWin = addWin;
  window.removeWin = removeWin;
  window.addTie = addTie;
  window.resetSeason = resetSeason;
  window.secureAction = secureAction;

  // inicializa UI (se n√£o veio nada do Firebase ainda)
  update(false);
</script>






